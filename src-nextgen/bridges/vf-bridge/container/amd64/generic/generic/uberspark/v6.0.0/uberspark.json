/*
    uberSpark code bridges json definition
*/

{
   	/* manifest header */
	   "uberspark-manifest":{
		"manifest_node_types" : [ "uberspark-bridge-vf" ],
		"uberspark_min_version" : "any",
		"uberspark_max_version" : "any"
	},

    "uberspark-bridge-vf" : {
		/* bridge header */
		"bridge-hdr":{
			"btype" : "container",
			"bname" : "uberspark",
			"execname" : "uberspark",
			"devenv" : "amd64",
			"arch" : "generic",
			"cpu" : "generic",
			"version" : "v6.0.0",
			"path" : ".",
			"params" : [ ],
			"container_fname" : "uberspark-bridge.Dockerfile"
		},

		"bridge_cmd" : [
			"	
				echo source C files: @@BRIDGE_SOURCE_C_FILES@@ &&
				echo include dirs: @@BRIDGE_INCLUDE_DIRS@@ &&
				echo include dirs with prefix: @@BRIDGE_INCLUDE_DIRS_WITH_PREFIX@@ &&
				echo bridge plugin dir: @@BRIDGE_PLUGIN_DIR@@ &&
				export var_bridge_include_dirs &&
				export vararray_bridge_include_dirs &&
				export include_prefix=\"-I\" &&
				export include_string &&
				var_bridge_include_dirs=\" @@BRIDGE_INCLUDE_DIRS@@ \" &&
				vararray_bridge_include_dirs=$(echo $var_bridge_include_dirs | tr \" \" \"\\n\") &&
				for include_dir_name in $vararray_bridge_include_dirs; do include_string=\"${include_string} ${include_prefix}${include_dir_name}\"; done &&
				echo \"include_string=$include_string\" &&
				frama-c -load-module @@BRIDGE_PLUGIN_DIR@@/Ubersparkvbridge -machdep gcc_x86_32 -kernel-msg-key pp -cpp-extra-args=\"$include_string\" @@BRIDGE_SOURCE_C_FILES@@ -hstart -then -val -then -hfinish
			"
		] 

	}

}
