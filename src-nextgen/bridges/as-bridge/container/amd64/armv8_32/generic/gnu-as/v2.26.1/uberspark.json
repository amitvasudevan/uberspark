/*
    uberSpark code bridges json definition
*/

{
   	/* manifest header */
	   "uberspark-manifest":{
		"namespace" : [ "uberspark-bridge-as" ],
		"version_min" : "any",
		"version_max" : "any"
	},

    "uberspark-bridge-as" : {
		/* bridge header */
		"bridge-hdr":{
			"btype" : "container",
			"bname" : "gnu-as",
			"execname" : "arm-linux-gnueabihf-gcc",
			"devenv" : "amd64",
			"arch" : "armv8_32",
			"cpu" : "generic",
			"version" : "v2.26.1",
			"path" : ".",
			"params" : [
				"-marm",
				"-march=armv8-a",
				"-mno-thumb-interwork"
			],
			"container_fname" : "uberspark_bridges.Dockerfile"
		},

		"params_prefix_obj" : "-c",
        "params_prefix_output" : "-o",
		"params_prefix_include" : "-I",
		
		"bridge_cmd" : [
			"export var_bridge_include_dirs_with_prefix",
			"export var_bridge_source_files",
			"var_bridge_include_dirs_with_prefix=\" @@BRIDGE_INCLUDE_DIRS_WITH_PREFIX@@ \"",
			"var_bridge_source_files=\" @@BRIDGE_SOURCE_FILES@@ \"",
			"vararray_bridge_source_files=$(echo $var_bridge_source_files | tr \" \" \"\\n\")",
			"for source_file_name in $vararray_bridge_source_files; do echo \"Compiling ${source_file_name} ...\" && arm-linux-gnueabihf-gcc @@BRIDGE_COMPILEDEFS_WITH_PREFIX@@ -marm -march=armv8-a -mno-thumb-interwork -c ${var_bridge_include_dirs_with_prefix} ${source_file_name} -o ${source_file_name}.o ; done"
		] 

	}

}
